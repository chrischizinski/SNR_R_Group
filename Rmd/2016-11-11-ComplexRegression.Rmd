---
title: "Multiple and complex regression"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

The RMarkdown file for this lesson can be found [here](https://raw.githubusercontent.com/chrischizinski/SNR_R_Group/master/Rmd/2016-10-20-XXXX.Rmd).

This lesson will follow Chapter 6 in Quinn and Keough (2002).

Load the packages we will be using in this lesson

```{r, message=FALSE}
library(RCurl)
library(tidyverse)
library(broom)
library(GGally)
library(devtools)

source_url('https://raw.githubusercontent.com/chrischizinski/SNR_R_Group/master/R/snr_r_group_functions.R')
```


## Multiple Linear regression analysis

Our previous lesson was based on regression models with a single predictor and single response variable.  We can expand on these by increasing the number of predictor variables, which are called are *multiple linear regression* models.  Many of the tools that we covered to assess outliers and model fit can also be used in multiple linear regression.  We will not spend a lot of time going back over these in this lesson.  

- Similar assumptions of the model to the simple models
- Fixed Xs, random Y

Model represented as: 
$$ y_i = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \dots + \beta_j x_{ij} + \dots \beta_p x_{ip} +    \epsilon_i  $$ 

Lets illustrate these models using the `lyon` data found in `chapt6` folder found in the github repository.

> Loyn (1987) selected 56 forest patches in southeastern Victoria, Australia, and related the abundance of forest birds in each patch to six predictor variables: patch area (ha), distance to nearest patch (km), distance to nearest larger patch (km), grazing stock (1 to 5 indicating light to heavy), altitude (m) and years since isolation (years). 

```{r}
bird_abund <- read_csv(getURL('https://raw.githubusercontent.com/chrischizinski/SNR_R_Group/master/data/ExperimentalDesignData/chpt6/loyn.csv'))

bird_abund$GRAZE <- as.factor(bird_abund$GRAZE)
bird_abund$YEAR_SINCE <- 1987 - bird_abund$YR.ISOL

glimpse(bird_abund)

```

Lets look at the correlation between the variables using the [`ggcorr()` function](https://briatte.github.io/ggcorr/) in  `GGally` package.

```{r}
# install.packages("GGally")

ggcorr(bird_abund[, 1:10])

ggcorr(bird_abund[, 1:10], geom = "blank", label = TRUE, hjust = 0.75) +
  geom_point(size = 10, aes(color = coefficient > 0, alpha = abs(coefficient) > 0.5)) +
  scale_alpha_manual(values = c("TRUE" = 0.25, "FALSE" = 0)) +
  guides(color = FALSE, alpha = FALSE)

```

We run the regression similarly to the simple regression model.


```{r}
bird_mod <- lm(ABUND ~ L10AREA + L10DIST + L10LDIST + GRAZE + ALT + YEAR_SINCE, data = bird_abund)

summary(bird_mod)

anova(bird_mod)
```

And now take a look at the prediction with the residuals.  First we want to use the `augment()` function from the `broom` package to create the predictions. 

```{r}
mod_pred <- augment(bird_mod)
glimpse(mod_pred)





scatter_with_box(xvar=".fitted",yvar=".resid", xlim=c(0,45), ylim=c(-20,20), xlabel ="Predicted value", ylabel = "Residual", data=mod_pred)


```


create a residual plot (std.resid) and a marginal plot 
How would we make plots of these predictions?
INteractions
